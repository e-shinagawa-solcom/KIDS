<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- 互換表示OFFを強制させる -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">

    <title>K.I.D.S.</title>


    <!-- jQuery -->
    <script src="/cmn/jquery/jquery-3.1.0.js"></script>
    <!-- jQuery Cookie -->
    <script src="/cmn/jquery/jquery-cookie-1.4.1.js"></script>
    <!-- jQuery UI -->
    <script src="/cmn/jquery/ui/jquery-ui-1.12.0.js"></script>
    <link rel="stylesheet" href="/cmn/jquery/ui/jquery-ui-1.12.0.css">
    <link rel="stylesheet" href="/cmn/jquery/ui/jquery-ui.theme.css">
    <!-- jQuery UI datepickerローカライズ用スクリプト -->
    <script src="/cmn/jquery/ui/datepicker-ja.js"></script>
    <!-- jQuery Validation Plugin -->
    <script src="/cmn/jquery/validation/jquery.validate.js"></script>
    <!-- jQuery tooltipster -->
    <script src="/cmn/jquery/tooltipster/js/tooltipster.bundle.js"></script>
    <link rel="stylesheet" href="/cmn/jquery/tooltipster/css/tooltipster.bundle.css">

    <!-- スタイル初期化 & 各種コントロールスタイル -->
    <link rel="stylesheet" href="/cmn/css/form/base.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/cmn/styles.css">
    <link rel="stylesheet" href="/search/cmn/form/css/forms.css">
    <link rel="stylesheet" href="/search/cmn/form/css/tabs.css">
    <link rel="stylesheet" href="/inv/cmn/form/css/forms.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/inv/regist/css/table.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/inv/regist/css/table-decide.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/inv/regist/css/table-box.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/inv/regist/css/form-buttons.css">
    <script src="/search/cmn/form/js/util-selectbox.js" defer></script>
    <!-- チェックボックスの切り替え処理 -->
    <script src="/search/cmn/search/js/toggleCheckbox.js" defer></script>
    <!-- 検索画面共通入力補助 -->
    <script src="/search/cmn/search/js/input-assist.js" defer></script>
    <!-- msw 表示 -->
    <script src="/search/cmn/msw/cmn/js/msw.js" defer></script>
    <!-- COOKIE関連の処理(検索画面) -->
    <script src="/search/cmn/search/js/cookie-functions.js" defer></script>
    <link rel="stylesheet" href="/cmn/css/base/base-general.css">
    <!-- datepickerの要素指定 -->
    <script src="/search/cmn/js/datepicker.js" defer></script>
    <!-- msw汎用スタイル -->
    <link rel="stylesheet" href="/search/cmn/css/msw.css">
    <!-- フォームボタン css -->
    <link rel="stylesheet" href="/search/cmn/css/form-buttons.css">
    <!-- フォームバリデーション -->
    <script src="/inv/cmn/js/validate-regist-form.js" defer></script>
    <!-- マスタ検索呼び出し -->
    <script src="/search/cmn/js/invoke-master-search.js" defer></script>
    <script src="/mold/lib/js/queryMasterData.js" defer></script>
    <!-- COOKIE 表示チェックボックス 保存/復元 -->
    <script src="/search/cmn/js/cookie-display-items.js" defer></script>
    <!-- キーバインド -->
    <!-- <script src="/search/cmn/js/key-bind.js" defer></script> -->
    <!-- 請求日設定 -->
    <script src="/search/cmn/js/date.js" defer></script>
    <script src="/cmn/js/functions.js" defer></script>
    <script src="/inv/cmn/js/msw-regist.js" defer></script>
    <script src="/cmn/jquery/tablesorter/jquery.tablesorter.js"></script>
    <script src="/cmn/jquery/tablesorter/jquery.tablesorter.widgets.js"></script>
    <script src="/cmn/js/table.js" defer></script>
    <script src="/inv/cmn/js/table.js" defer></script>
    <script src="/cmn/js/setinputmode.js" defer></script>
</head>

<body class="background">
    <!-- 入力フォーム -->
    <div class="form-box--notabs-for-regists">
        <!-- フォームヘッダ -->
        <div class="form-box__header">
            <p class="form-box__header__title">請求書修正</p>
        </div>
        <!-- フォームコンテンツ -->
        <div class="form-box__contents--with-scroll">
            <form name="Invoice" method="post">
                <!-- <input type="submit"> -->
                <div class="regist-box-area">

                    <div class="regist-box-area-1">
                        <div class="regist-box1">
                            <div class="regist-line regist-float">
                                <span class="regist-label w-465">
                                    <span class="regist-label__text50">顧客</span>
                                    <input class="disTxt05L input-code" name="lngCustomerCode" type="text" iscustomer="yes" alt="Customer" disabled value="_%strCustomerCode%_">
                                    <input class="disTxt2xL input-name" name="strCustomerName" type="text" disabled value="_%strCustomerName%_">
                                    <input type="hidden" name="lngCustomerCode" value="_%strCustomerCode%_">
                                </span>
                            </div>
                            <div class="regist-box1">
                                <div class="regist-line regist-float">
                                    <span class="regist-label">
                                        <span class="regist-label__text50">起票者</span>
                                        <input class="Txt07L" name="lngInputUserCode" type="text" value="_%strUserCode%_" alt="InputUser">
                                        <input class="disTxt120pxL" name="strInputUserName" type="text" value="_%strUserName%_" disabled>
                                        <span>
                                            <a href="#">
                                                <img class="msw-button button" invokeMSWName="msw-inputuser" src="/img/type01/msw/cmn/open_off_bt.gif" alt="msw">
                                            </a>
                                        </span>
                                        <input type="hidden" name="strInputUserName" value="_%strUserName%_">
                                    </span>
                                    <span class="regist-label">
                                        <span class="regist-label__text50">請求日</span>
                                        <input style="ime-mode:disabled;" class="Txt10L is-date" type="text" name="ActionDate" value="_%dtmInvoiceDate%_" maxlength="10">
                                    </span>
                                </div>
                                <br>
                                <div class="regist-line regist-float">
                                    <span class="regist-label w-465" style="height:58px;">
                                        <span class="regist-label__text50">備考</span>
                                        <span class="regist-label__required-mark">◎</span>
                                        <span class="regist-label__text50">但し</span>
                                        <input class="TxtStyle2xL" name="description" type="text" value="_%description%_">
                                        <span class="regist-label__text50">代として</span>
                                        <br>
                                        <br>
                                        <span class="regist-label__text50"></span>
                                        <input class="Txt54L" name="strnote" type="text" value="_%strNote%_">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="regist-box-area-2">
                        <div class="regist-box2">
                            <span class="regist-label  regist-label-w190">
                                <span class="regist-label__text50">請求月</span>
                                <input id="strinvoicemonth" class="TxtStyle05L" style="text-align: right;" name="strinvoicemonth" value="_%strInvoiceMonth%_">
                                </input>
                                <span class="regist-label__bold">月分</span>
                            </span>
                        </div>
                        <div class="regist-box3">
                            <span class="regist-label regist-label-box3">
                                <span class="regist-label__text115">前月請求残額(税込)</span>
                                <span class="regist-label__text20 moneyclass">_%strMonetaryUnitSign%_</span>
                                <input class="disTxt14R" name="curlastmonthbalance" type="text" disabled value="_%curLastMonthBalance%_">
                                <input type="hidden" name="curlastmonthbalance" value="_%curLastMonthBalance%_">
                                <input type="hidden" name="lngmonetaryunitcode" value="_%lngmonetaryunitcode%_">
                                <input type="hidden" name="lngtaxclasscode" value="_%lngTaxClassCode%_">
                                <input type="hidden" name="curtax" value="_%curTax1%_">
                            </span>
                        </div>
                        <div style="height: 92px;">
                            <div class="regist-box2-2" style="margin-top: 5px;">
                                <span class="regist-label" style="height: 60px;padding-top:5px;">
                                    <input type="radio" id="invoiceMode1" name="strinvoicemode" value="1" class="form-control form-control-sm" style="width:12px;height: 15px;background-color: #f0f0f6;"
                                        _%invoiceMode1%_>
                                    <span class="regist-label__text65">請求日請求</span>
                                    <br>
                                    <br>
                                    <input type="radio" id="invoiceMode2" name="strinvoicemode" value="2" class="form-control form-control-sm" style="width:12px;height: 15px;background-color: #f0f0f6;" _%invoiceMode2%_>
                                    <span class="regist-label__text65">締め日請求</span>
                                </span>
                            </div>
                            <div class="regist-box2-3" style="margin-top: 5px;">
                                <span class="regist-label regist-label-w135">
                                    <span class="regist-label__text15">自</span>
                                    <input class="TxtStyle04L is-date" name="dtmchargeternstart" type="text" value="_%dtmChargeternStart%_"  maxlength="10">
                                </span>
                                <br>
                                <span class="regist-label regist-label-w135" style="margin-top: 5px;">
                                    <span class="regist-label__text15">至</span>
                                    <input class="TxtStyle04L is-date" name="dtmchargeternend" type="text" value="_%dtmChargeternEnd%_" maxlength="10">
                                </span>
                            </div>
                            <div class="regist-box3-2" style="margin-top: 5px;">
                                <span class="regist-label regist-label-box3">
                                    <span class="regist-label__text65">当月請求額</span>
                                    <span class="regist-label__text20 moneyclass">_%strMonetaryUnitSign%_</span>
                                    <input class="disTxt14R" name="curthismonthamount" type="text" disabled value="_%curThisMonthAmount%_">        
                                    <input type="hidden" name="curthismonthamount" value="_%curThisMonthAmount%_">
                                </span>
                                <br>
                                <span class="regist-label regist-label-box3" style="margin-top: 5px;">
                                    <span class="regist-label__text65">消費税</span>
                                    <span class="regist-label__text20 moneyclass">_%strMonetaryUnitSign%_</span>
                                    <input class="disTxt14R" name="curtaxprice" type="text" value="_%curTaxPrice1%_" disabled>
                                    <input type="hidden" name="curtaxprice" value="_%curTaxPrice1%_">
                                </span>
                            </div>
                        </div>
                        <div class="regist-box2">
                            <span class="regist-label regist-label-w190" style="margin-top:5px;">
                                <span class="regist-label__text177">
                                    再印刷を備考に明記する
                                    <input name="strnotecheck" class="is-search" type="checkbox">
                                </span>
                            </span>

                        </div>
                        <div class="regist-box3">
                            <span class="regist-label regist-label-box3" style="margin-top:5px;">
                                <span class="regist-label__text115">差し引き合計額</span>
                                <span class="regist-label__text20 moneyclass">_%strMonetaryUnitSign%_</span>
                                <input class="disTxt14R" name="notaxcurthismonthamount" value="_%noTaxCurtTisMonthAmount%_" type="text" disabled>
                                <input type="hidden" name="notaxcurthismonthamount" value="_%noTaxCurtTisMonthAmount%_">
                            </span>
                        </div>
                    </div>
                </div>
                <div class="flex-container">
                    <table class="table-box" style="height: 150px;">
                        <tr>
                            <td style="width: 800px;">
                                <div class="regist-label div-table">
                                    <table class="table-fix">
                                        <thead id="tableA_chkbox_head">
                                            <tr>
                                                <th>
                                                    <input name="allSel" type="checkbox" id="allChecked">
                                                </th>
                                            </tr>
                                        </thead>
                                        <!-- 固定ヘッダ -->
                                    </table>
                                    <div id="header_h">
                                        <table class="table-decide-description" name="T" id="tableA_head">
                                            <thead>
                                                <!-- 水平ヘッダ -->
                                                <tr>
                                                    <th class="serial">No.</th>
                                                    <th class="slipcode">KWGNO.
                                                        <span></span>
                                                    </th>
                                                    <th class="customerno">納品書NO.
                                                        <span></span>
                                                    </th>
                                                    <th class="customer">納品先
                                                        <span></span>
                                                    </th>
                                                    <th class="deliverydate">納品日
                                                        <span></span>
                                                    </th>
                                                    <th class="price">税抜金額
                                                        <span></span>
                                                    </th>
                                                    <th class="taxclass">課税区分
                                                        <span></span>
                                                    </th>
                                                    <th class="tax">税率
                                                        <span></span>
                                                    </th>
                                                    <th class="taxamount">消費税額
                                                        <span></span>
                                                    </th>
                                                    <th class="remarks">備考
                                                        <span></span>
                                                    </th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <div id="header_v">
                                        <table class="table-decide-description" name="TV" id="tableA_chkbox">
                                            <tbody>
                                                <tr>
                                                    <td class="checkbox center">
                                                        <input type="checkbox" name="edit" class="check" />
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div id="data">
                                        <table class="table-decide-description" name="T" id="tableA">
                                            <thead style="display: none;">
                                                <!-- 水平ヘッダ -->
                                                <tr>
                                                    <th class="serial">No.</th>
                                                    <th class="slipcode">KWGNO.</th>
                                                    <th class="customerno">納品書NO.</th>
                                                    <th class="customer">納品先</th>
                                                    <th class="deliverydate">納品日</th>
                                                    <th class="price">税抜金額</th>
                                                    <th class="taxclass">課税区分</th>
                                                    <th class="tax">税率</th>
                                                    <th class="taxamount">消費税額</th>
                                                    <th class="remarks">備考</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tableA">
                                                <tr>
                                                    <td class="serial center">
                                                        <span></span>
                                                    </td>
                                                    <td class="slipcode"></td>
                                                    <td class="customerno" style="text-align: center;"></td>
                                                    <td class="customer">
                                                        <span class="customercode"></span>
                                                        <span class="customername"></span>
                                                    </td>
                                                    <td class="deliverydate"></td>
                                                    <td class="price right"></td>
                                                    <td class="taxclass">
                                                        <span class="taxclasscode"></span>
                                                        <span class="taxclassname"></span>
                                                    </td>
                                                    <td class="tax right"></td>
                                                    <td class="taxamount right"></td>
                                                    <td class="remarks"></td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </td>
                            <td style="width: 50px;"></td>
                            <td style="width: 100px;">
                                <button type="button" class="btn btn-light btn-kids btn-kids-sm" id="search">検索条件入力</button>
                                <br>
                                <br>
                                <br>
                                <button type="button" class="btn btn-light btn-kids btn-kids-sm" id="add">追加</button>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="regist-line">
                    <table class="table-box">
                        <tr>
                            <td style="vertical-align: top;width: 800px;">
                                <div class="regist-label div-decide-table">
                                    <table class="table-decide-fix" id="tableB_no_head">
                                        <thead>
                                            <tr>
                                                <th>No.</th>
                                            </tr>
                                        </thead>
                                        <!-- 固定ヘッダ -->
                                    </table>
                                    <div id="header_decide_h">
                                        <table class="table-decide-description" name="DECIDE_T" id="tableB_head">
                                            <thead>
                                                <tr>
                                                    <th class="slipcode">KWGNO.</th>
                                                    <th class="customerno">納品書NO.</th>
                                                    <th class="customer">納品先</th>
                                                    <th class="deliverydate">納品日</th>
                                                    <th class="price">税抜金額</th>
                                                    <th class="taxclass">課税区分</th>
                                                    <th class="tax">税率</th>
                                                    <th class="taxamount">消費税額</th>
                                                    <th class="remarks">備考</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <div id="header_decide_v">
                                        <table class="table-decide-description" name="DECIDE_TV" id="tableB_no">
                                            <tbody>
                                                <tr>
                                                    <td class="serial center">
                                                        <span></span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div id="decide_data">
                                        <table class="table-decide-description" name="DECIDE_T" id="tableB">
                                            <tbody>
                                                <tr>
                                                    <td class="slipcode"></td>
                                                    <td class="customerno" style="text-align: center;"></td>
                                                    <td class="customer">
                                                        <span class="customercode"></span>
                                                        <span class="customername"></span>
                                                    </td>
                                                    <td class="deliverydate"></td>
                                                    <td class="price right"></td>
                                                    <td class="taxclass">
                                                        <span class="taxclasscode"></span>
                                                        <span class="taxclassname"></span>
                                                    </td>
                                                    <td class="tax right"></td>
                                                    <td class="taxamount right"></td>
                                                    <td class="remarks"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </td>
                            <td style="text-align: center;">
                            </td>
                            <td>
                                <button type="button" class="btn btn-light btn-kids btn-kids-sm" id="delete">削除</button>
                                <br>
                                <br>
                                <br>
                                <button type="button" class="btn btn-light btn-kids btn-kids-sm" id="alldelete">全削除</button>
                            </td>
                        </tr>
                    </table>
                </div>

                <input type="hidden" name="ActionScriptName" value="_%ActionScriptName%_">
                <input type="hidden" name="strSessionID" value="_%strSessionID%_">
                <input type="hidden" name="invConditionUrl" value="_%invConditionUrl%_">
                <input type="hidden" name="lngInvoiceNo" value="_%lngInvoiceNo%_">
                <input type="hidden" name="lngRevisionNo" value="_%lngRevisionNo%_">
                <input type="hidden" name="strMode" value="renewPrev">
            </form>
        </div>
        <div class="preview-button">
            <button type="button" class="btn btn-light btn-kids btn-kids-sm" style="width: 80px;" id="preview">プレビュー</button>
        </div>
        <div class="msw-loadpoints">
            <!-- MSW 顧客マスタ検索 -->
            <iframe class="msw-customer" src="/search/cmn/msw/customer/mswcustomer.html" frameborder="0">
            </iframe>
            <!-- MSW 入力者マスタ検索 -->
            <iframe class="msw-inputuser" src="/search/cmn/msw/inputuser/mswinputuser.html" frameborder="0">
            </iframe>
        </div>
    </div>

    <script type="text/javascript">
        function $E(name) { return document.getElementById(name); }
        function scroll() {
            $E("header_h").scrollLeft = $E("data").scrollLeft;// データ部のスクロールをヘッダに反映
            $E("header_v").scrollTop = $E("data").scrollTop;// データ部のスクロールをヘッダに反映
        }
        $E("data").onscroll = scroll;


        function decide_scroll() {
            $E("header_decide_h").scrollLeft = $E("decide_data").scrollLeft;// データ部のスクロールをヘッダに反映
            $E("header_decide_v").scrollTop = $E("decide_data").scrollTop;// データ部のスクロールをヘッダに反映
        }
        $E("decide_data").onscroll = decide_scroll;
    </script>
    <script>
        // var actiondate = $('input[name="ActionDate"]').val();
        // var dtmchargeternstart = $('input[name="dtmchargeternstart"]').val();
        // var dtmchargeternend = $('input[name="dtmchargeternend"]').val();
        // if (dtmchargeternstart == dtmchargeternend && actiondate == dtmchargeternend)
        // {
        //     $('#invoiceMode1').prop('checked',true);
        // } else {            
        //     $('#invoiceMode2').prop('checked',true);
        // }
        // 修正初期状態
        var renewInit = function (invoiceNo, revisionNo) {
            // 入力値を取得
            // 顧客
            var params = {
                mode: 'ajaxRenew',
                invoiceNo: invoiceNo,
                revisionNo: revisionNo,
                strSessionID: $('input[name="strSessionID"]').val(),
            }


            // 検索する
            var search = {
                url: '/inv/regist/condition.php?strSessionID=' + $.cookie('strSessionID'),
                type: 'post',
                dataType: 'json',
                data: params
            };

            $.ajax(search)
                .done(function (response) {
                    console.log(response);

                    $.createTableRenew(response);
                })
                .fail(function (response) {
                    alert(response.responseText);
                    console.log(response.responseText);

                    return;
                });

            return false;
        };
        setTimeout(renewInit('_%lngInvoiceNo%_', '_%lngRevisionNo%_'), 900);
    </script>